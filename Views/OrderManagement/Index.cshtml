@model ProntoPizzas.Models.OrderManagementIndexViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<div class="container mt-4">
	<h1>Order Management</h1>
	<!-- Orders and Their Actions Table -->
	<section class="mt-5">
		<h2>Current Orders</h2>
		@if (Model.Orders.Any())
		{
			<div class="table-responsive custom-table">
				<table class="table table-striped table-hover">
					<thead class="table-dark">
						<tr>
							<th>Customer Name</th>
							<th>Delivery Address</th>
							<th>Items</th>
							<th>Status</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var ur in Model.Orders.Where(o => o.OrderStatus != "Delivered"))
						{
							<tr>
								<td>
									<i class="bi bi-person"></i> @ur.CustomerName
								</td>
								<td>
									<i class="bi bi-geo-alt"></i> @ur.DeliveryAddress
								</td>
								<td>
									<ul class="list-unstyled mb-0">
										@foreach (var item in ur.OrderProducts)
										{
											<li>
												<i class="bi bi-pizza"></i> @item.Quantity x @item.Product.PizzaName
											</li>
										}
									</ul>
								<td>
									@{
										var statuses = new[] { "Preparing", "Baking", "Delivering", "Delivered", "Cancelled" };
									}
									<form asp-action="Update" method="post" asp-route-id="@ur.OrderId" style="display:inline;" class="select-input">
										<select name="status" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
											@foreach (var s in statuses)
											{
												if (s == ur.OrderStatus)
												{
													<option value="@s" selected>@s</option>
												}
												else
												{
													<option value="@s">@s</option>
												}
											}
										</select>
									</form>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		}
		else
		{
			<div class="alert alert-info">
				<i class="bi bi-info-circle"></i> No incomplete orders found in the system.
			</div>
		}
	</section>
</div>